#!/usr/bin/env python3
# Copy an example from the scripts the user's `cylc-src` directory:

from dataclasses import dataclass
from pathlib import Path
from shlex import split
from subprocess import run
from typing import Dict

from cylc.flow.config import WorkflowConfig


TITLE_W = 80
VERSION_COL_W = 10


@dataclass
class example:
    name: str
    path: Path
    flowfile: Path
    desc: str = ''
    title: str = ''
    written_for: str = ''
    written_with: str = ''

    def __init__(self, flowfile: Path) -> None:
        self.name = flowfile.parent.name
        self.path = flowfile.parent
        self.flowfile = flowfile
        self.get_metadata()

    def __str__(self):
        mdlink = f'[{self.title}](./{self.name})'
        return (
            f'| {mdlink:80} | {self.written_for:12} |'
            f' {self.written_with:12} |'
        )

    def get_metadata(self):
        try:
            config = WorkflowConfig(
                'foo',
                self.flowfile,
                {}
            )
        except:  # noqa
            pass
        else:
            meta = config.get_config(['meta'])
            self.desc = meta.get('description', '')
            self.title = meta.get('title', '')
            self.written_for = meta.get('written for cylc version', '')
            self.written_with = meta.get('tested with cylc version', '')


examples_dir = Path(__file__).parent.parent

examples = [i for i in examples_dir.rglob("*/suite.rc")] + [
    i for i in examples_dir.rglob("*/flow.cylc")
]


examples = [example(i) for i in examples]

print(f'| {"Workflow":80} | {"Written With":12} | {"Tested On":12} |\n| {"-"*80} | {"-"*12} | {"-"*12} |')
for e in examples:
    print(e)